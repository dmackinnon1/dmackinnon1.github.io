<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
 <!--These two scripts take care of the communication with CODAP-->
<script src="https://concord-consortium.github.io/codap-data-interactives/Common/js/iframe-phone.js" language="javascript"></script>
<script src="https://concord-consortium.github.io/codap-data-interactives/Common/js/codap_helper.js" language="javascript"></script>


<body>

<button id='testButton' onclick='roll100Dice(event)'>roll 100 pairs of dice</button>
</body>


<script>

function check(event) {
	codapHelper.checkForCODAP();
};

function randomInt(lessThan){
	var selection = Math.floor(Math.random()*(lessThan));
	return selection;
};

function randomRange(greaterThan, lessThan){
	var shifted = randomInt(lessThan - greaterThan);
	return lessThan - shifted; 
}


var sampleNumber = 1;
function roll100Dice() {
	if( !codapHelper.checkForCODAP()) return;
           
	//generates child case
	var doSample = function( iResult) {
		var tID = iResult.caseID;
              	var tHowMany = 100;
                var rollDice = function() {
                    if( tHowMany > 0) {
                        var die1 = randomRange(0,6);
			var die2 = randomRange(0,6);
                        // Tell CODAP to create a case in the child collection
                        codapHelper.createCase('dice', die1, die2, tID, rollDice);
                        tHowMany--;
                    } else codapHelper.closeCase('samples', null, tID);
		};
		rollDice(); //calls the child generator
	}
	codapHelper.openCase( 'samples', sampleNumber, doSample);
	sampleNumber ++;
};
	
codapHelper.initSim({
        name: 'Test',
        dimensions: {width: 300, height: 150},
        collections: [ 
            {
                name: 'samples',
                // The parent collection has just one attribute
                attrs: [ {name: "sample", type: 'categorical'}],
                childAttrName: "sample"
            },
            {
                name: 'dice',
                labels: {
                    pluralCase: "dice",
                    setOfCasesWithArticle: "a sample"
                },
                // The child collection also has just one attribute
                attrs: [{name: "die1", type: 'numeric', precision: 1},{name: "die2", type: 'numeric', precision: 1}]
            }
        ]
    });
</script>

</html>

