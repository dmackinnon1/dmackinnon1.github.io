<!DOCTYPE HTML>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script src="https://d3js.org/d3.v4.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<title>D3jNotebook - modular Phyllotaxis</title>
</head>
<style>

svg {
  display: block; 
  margin: auto ;
 }
.centered {
  text-align: center;
}
form {
  padding: 5px;
  font-size: large;
}
h1{
   padding: 10px;
   padding-top:20px;
   margin:5px;
}
</style>
<body>
  <h1>Phyllotaxis Spirals </h1>
  <div class="inputDiv centered" width ="300">
    <form>
      modulo: <input type="number" id="modInput" min="1" max="20" step="1" value="1" onchange="modChange(this)">
    </form>
    <form>
      dot size: <input type="number" id="sizeInput" min="2" max="20" step="1" value="10" onchange="sizeChange(this)">
    </form>
    <form>
      <div class="checkbox">
        <label><input id="scale" type="checkbox" onchange="scaleChange(this)">scale dots</label>
      </div>
    </form>
  </div>
  <hr>
  <div class="centered">
  <svg width="600" height="600"></svg>
  </div>
  <hr>  
</body>
<script>

/*
* Phyllotaxis spiral, adjustable
*/

function range(n) {
  return Array.from((Array(n)).keys()) ;
};

let spacer = 200;
let total = 400;
let data = range(total);
let offset = 600/2;
let dotSize = 10;
let dotGrow = false;
//creating the dots
let svg = d3.select("svg");
svg.selectAll("circle")
    .data(data)
    .enter().append("circle")
      .attr("cy", function(d) { return  offset + radial(d)*xComp(philo(d))})
      .attr("cx", function(d) { return offset + radial(d)*yComp(philo(d))})
      .attr("r", function(d) { return dotSize; });

//setup of coloring based on mod selection
let modValue = 1;
function colorDots() {
    let svg2 = d3.select("svg");
    svg2.selectAll("circle")
      .data(data).style("fill", function(d) {
        if (d%modValue === 0) {
          return 'black';
        } else {
          return 'grey';
        }
      }).attr("r", function(d) { 
          console.log(dotGrow);
          if(dotGrow) {
            return ((d + total/2)/total)*dotSize;
          } else {
            return dotSize;
          }
        });
};     
//initial coloring of dots
colorDots();

//colouring of dots after mod selection change
function modChange(e) {
    modValue = e.value;
    colorDots();
};

function sizeChange(e) {
    dotSize = e.value;
    colorDots();
};

function scaleChange(e) {
    dotGrow = e.checked;
    console.log(dotGrow);
    colorDots();
};

//phylotaxis specifics

function philo(n) {
  let d = n + 1; 
  return d*Math.PI*(Math.sqrt(5) +1);
}

function xComp(t) {
  return Math.cos(t);
}

function yComp(t) {
  return Math.sin(t);
}

function radial(n) {
  let d = n + 1;
  return Math.sqrt(d*spacer);
}
</script>
</html>
